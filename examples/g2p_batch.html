<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Text Generation Example</title>
    
</head>
<body>

<h1>G2P Example</h1>
<div>
    <input type="text" id="textInput"  value ="hello world" placeholder="Enter some text here,not long">
    <button id="myButton">G2P</button>
</div>
<div id="output"></div>
<div id="ipa"></div>
<script src = "./arpa_to_ipa.js"></script>
<script type="module">
   import { pipeline, env } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2';
   env.allowLocalModels = true;
   env.localModelPath = "./";

async function generateText() {
    // Hugging Faceのpipeline関数を使用してモデルをロードします。
    const generator = await pipeline('text2text-generation', 'mini-bart-g2p',{quantized: false});

    // 入力テキストとパラメータを指定します。
    const inputTexts = document.getElementById('textInput').value.split(" ");
    const options = { max_new_tokens: 100 };

    // モデルからテキストを生成します。
    const outputs = await generator(inputTexts, options);
    console.log(outputs)
    const arpa = outputs[0].generated_text
    // 出力をHTMLに表示します。
    document.getElementById('output').innerText = arpa;
    document.getElementById('ipa').innerText = arpa_to_ipa(arpa).replace(/\s/g, "");
}

//generateText().catch(console.error);

document.getElementById('myButton').onclick = generateText

</script>

</body>
</html>
