<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Match-TTS Onnx with direct IPA Symbol Input</title>
</head>
<body>
    <h1>Match-TTS Onnx with direct IPA Symbol Input</h1>
    <div>this example using Quantized version(lowquality and slow) because of Github Page 100MB limitation</div><br>

    Get IPA Symbols <a href="https://raw.githubusercontent.com/akjava/English-To-IPA-Collections/main/dictionaries/cumdict-ipa_simplified_vowel-aligned.tsv" target ="new_window">IPA Dictionary</a><br>
    <br>
   
    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.webgpu.min.js"></script>
    
    <script type="module">
        import { MatchaTTSRaw } from "./js-esm/matcha_tts_raw.js";
        import { webWavPlay } from "./js-esm/web_wav_play.js";

        let matcha_onnx
        async function main() {
            console.log("main called")
            if(!matcha_onnx){
                matcha_onnx = new MatchaTTSRaw()
                console.time("load model");
                await matcha_onnx.load_model('./models/matcha-tts/ljspeech_sim_q8.onnx',{ executionProviders: ['webgpu','wasm'] });
                
                console.timeEnd("load model");
            }else{
                console.log("session exist skip load model")
            }
            const text =  document.getElementById('textInput').value
            const speed = document.getElementById('speed').value
            const tempature = document.getElementById('temperature').value

            console.time("infer");
            const result = await matcha_onnx.infer(text, tempature, speed);
            console.timeEnd("infer");

            webWavPlay(result)
        }

        function update_range2(){
            const value = document.getElementById('temperature').value
            //let formattedNumber = value.toString().padStart(3, '0');
            document.getElementById('tempature_label').textContent  = value//formattedNumber
        }
        function update_range3(){
            const value = document.getElementById('speed').value
            //let formattedNumber = value.toString().padStart(3, '0');
            document.getElementById('speed_label').textContent  = value//sformattedNumber
        }

        window.onload = async function(){
            document.getElementById('myButton').onclick = main;
            document.getElementById('temperature').onchange = update_range2
            document.getElementById('speed').onchange = update_range3
        }

    </script>
   
    <input type="text" id="textInput"  value ="həlˈoʊ wˈɜːld" placeholder="Enter some ipa-text here...">
    <button id="myButton">Speak</button><br>

    <label for ="temperature" style="width: 110px;display: inline-block;">Temperature</label>
    <input type="range" id="temperature"  min="0" max="1.0" value="0.5" step="0.1"/>
    <label for ="temperature" id="tempature_label">0.5</label><br>

    <label for ="speed" style="width: 110px;display: inline-block;">Speed</label>
    <input type="range" id="speed"  min="0.1" max="2.0" value="1.0" step="0.1"/>
    <label for ="speed" id="speed_label">1.0</label>
</body>
</html>